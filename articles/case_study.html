<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Case study: targeted metabolite detection using TARDIS in cardiovascular disease • TARDIS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Case study: targeted metabolite detection using TARDIS in cardiovascular disease">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TARDIS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/case_study.html">Case study: targeted metabolite detection using TARDIS in cardiovascular disease</a></li>
    <li><a class="dropdown-item" href="../articles/gui_tutorial.html">Targeted peak integration of LC-MS data using T.A.R.D.I.S.</a></li>
    <li><a class="dropdown-item" href="../articles/quick_start.html">Quick start for targeted peak integration of LC-MS data using TARDIS</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Case study: targeted metabolite detection using TARDIS in cardiovascular disease</h1>
                        <h4 data-toc-skip class="author">Pablo
Vangeenderhuysen</h4>
            
            <h4 data-toc-skip class="date">2025-10-23</h4>
      

      <div class="d-none name"><code>case_study.rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>TARDIS</code> offers an easy and straightforward way to
automatically calculate area under the peak, max intensity and various
quality metrics for targeted chemical compounds in LC-MS data. It makes
use of an established retention time correction algorithm from the
<code>xcms</code> package and loads MS data as <code>Spectra</code>
objects so it’s easily integrated with other tools of the
<em>Rformassspectrometry</em> initiative.</p>
<p>See <a href="https://github.com/pablovgd/T.A.R.D.I.S./blob/main/README.md" class="external-link">README</a>
for installation instructions.</p>
<p>In this vignette, a case study on publicly available biological data
is described. We presume that we discovered a list of important
metabolite biomarkers for cardiovascular disease (CVD), which we would
like to validate in this dataset.</p>
</div>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>We use the MetaboLights dataset <a href="https://www.ebi.ac.uk/metabolights/editor/MTBLS8735/descriptors" class="external-link">MTBLS8735</a>,
an example untargeted metabolomics dataset tailored to quantify the
small polar metabolome in human plasma samples and aimed to identify
differences between individuals suffering from a cardiovascular disease
(CVD) and healthy controls (CTR). The subset analyzed here includes data
for three CVD patients, three CTR individuals, and four quality control
(QC) samples. The QC samples, representing a pooled serum sample from a
large cohort, were measured repeatedly throughout the experiment to
monitor signal stability.</p>
<p>All samples were analyzed using ultra-high-performance liquid
chromatography (UHPLC) (Agilent 1290; Agilent Technologies, Santa Clara,
CA, USA) coupled to a Q-TOF mass spectrometer (TripleTOF 5600+; AB
Sciex, Foster City, CA, USA). The chromatographic separation was based
on hydrophilic interaction liquid chromatography (HILIC) and performed
using an Acquity BEH amide, 100 x 2.1 mm column (Waters Corporation,
Milford, MA, USA).</p>
<p>The list of internal standards: Alanine 13C315N (0.9 μg/mL), arginine
13C615N4 (1.8 μg/mL), aspartic acid 13C415N (1.3 μg/mL), cystine
13C615N2 (1.2 μg/mL), glutamic acid 13C515N (1.5 μg/mL), glycine 13C215N
(0.8 μg/mL), histidine 13C615N3 (1.6 μg/mL), isoleucine 13C615N (1.3
μg/mL), leucine 13C615N (1.3 μg/mL), lysine 13C615N2 (1.5 μg/mL),
methionine 13C515N (1.5 μg/mL), phenylalanine 13C915N (1.7 μg/mL),
proline 13C515N (1.2 μg/mL), serine 13C315N (1.1 μg/mL), threonine
13C415N (1.2 μg/ mL), tyrosine 13C915N (1.8 μg/mL) and valine 13C515N
(1.2 μg/mL).</p>
<p>For more details, we refer to the MetaboLights repository.</p>
</div>
<div class="section level2">
<h2 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h2>
<p>The first step is creating a <code>data.frame</code> that describes
the metabolites of interest. In this case, this are the internal
standards and the 6 biomarkers of interest. Following columns at least
need to be present for each compound:</p>
<ul>
<li>A compound ID, a unique identifier</li>
<li>A compound Name</li>
<li>Theoretical or measured <em>m/z</em>
</li>
<li>Expected RT (in minutes)</li>
<li>A column that indicates the polarity of the formed ion for that
compound</li>
</ul>
<p>Extra columns can be included in the file, but will be ignored by
<code>TARDIS</code> unless otherwise indicated.</p>
<p>An input file (either .xlsx or .csv) can be converted to a correct
data.frame using the <code><a href="../reference/createTargetList.html">createTargetList()</a></code> function. Input
parameters needed are: the path to the file, the patterns for positive
and negative ionization, the polarity of interest, the columnn that
contains the ionization mode and the other columns of interest.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv2</a></span><span class="op">(</span><span class="st">"vignette_data/bio_targets.csv"</span>,sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="1%">
<col width="16%">
<col width="9%">
<col width="3%">
<col width="3%">
<col width="4%">
<col width="1%">
<col width="9%">
<col width="3%">
<col width="7%">
<col width="3%">
<col width="5%">
<col width="5%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="2%">
<col width="2%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">name</th>
<th align="left">abbreviation</th>
<th align="left">formula</th>
<th align="left">POS</th>
<th align="left">NEG</th>
<th align="right">RT</th>
<th align="left">data_set</th>
<th align="left">sample</th>
<th align="left">operator</th>
<th align="right">version</th>
<th align="left">quality_NEG</th>
<th align="left">quality_POS</th>
<th align="left">mz</th>
<th align="left">mzmin</th>
<th align="left">mzmax</th>
<th align="right">rtmin</th>
<th align="right">rtmax</th>
<th align="left">rt</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Carnitine (D3)</td>
<td align="left">carnitine_d3</td>
<td align="left">164.124</td>
<td align="left">[M+H]+</td>
<td align="left">NA</td>
<td align="right">61</td>
<td align="left">2019_11_matrix_effect</td>
<td align="left">serum</td>
<td align="left">Mar Garcia-Aloy</td>
<td align="right">2</td>
<td align="left">3_bad</td>
<td align="left">2_medium</td>
<td align="left">165.131276</td>
<td align="left">165.126276</td>
<td align="left">165.136276</td>
<td align="right">51</td>
<td align="right">71</td>
<td align="left">1.016666667</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Creatinine (N-Methhyl_D3)</td>
<td align="left">creatinine_methyl_d3</td>
<td align="left">116.0777</td>
<td align="left">[M+H]+</td>
<td align="left">[M-H]-</td>
<td align="right">126</td>
<td align="left">2019_11_matrix_effect</td>
<td align="left">serum</td>
<td align="left">Mar Garcia-Aloy</td>
<td align="right">2</td>
<td align="left">2_medium</td>
<td align="left">2_medium</td>
<td align="left">117.084976</td>
<td align="left">117.079976</td>
<td align="left">117.089976</td>
<td align="right">116</td>
<td align="right">136</td>
<td align="left">2.1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Glucose (6,6-D2)</td>
<td align="left">glucose_d2</td>
<td align="left">182.0759</td>
<td align="left">[M+Na]+</td>
<td align="left">[M+CHO2]-</td>
<td align="right">166</td>
<td align="left">2019_11_matrix_effect</td>
<td align="left">serum</td>
<td align="left">Mar Garcia-Aloy</td>
<td align="right">2</td>
<td align="left">1_good</td>
<td align="left">2_medium</td>
<td align="left">205.06512</td>
<td align="left">205.06012</td>
<td align="left">205.07012</td>
<td align="right">156</td>
<td align="right">176</td>
<td align="left">2.766666667</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">L-Alanine (13C3, 99%; 15N, 99%)</td>
<td align="left">alanine_13C_15N</td>
<td align="left">93.0548</td>
<td align="left">[M+H]+</td>
<td align="left">[M-H]-</td>
<td align="right">167</td>
<td align="left">2019_11_matrix_effect</td>
<td align="left">serum</td>
<td align="left">Mar Garcia-Aloy</td>
<td align="right">2</td>
<td align="left">2_medium</td>
<td align="left">1_good</td>
<td align="left">94.062076</td>
<td align="left">94.057076</td>
<td align="left">94.067076</td>
<td align="right">157</td>
<td align="right">177</td>
<td align="left">2.783333333</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">L-Arginine HCl (13C6, 99%; 15N4, 99%)</td>
<td align="left">arginine_13C_15N</td>
<td align="left">184.1199</td>
<td align="left">[M+H]+</td>
<td align="left">[M-H]-</td>
<td align="right">183</td>
<td align="left">2019_11_matrix_effect</td>
<td align="left">serum</td>
<td align="left">Mar Garcia-Aloy</td>
<td align="right">2</td>
<td align="left">0_perfect</td>
<td align="left">0_perfect</td>
<td align="left">185.127176</td>
<td align="left">185.122176</td>
<td align="left">185.132176</td>
<td align="right">173</td>
<td align="right">193</td>
<td align="left">3.05</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">L-Aspartic acid (13C4, 99%; 15N, 99%)</td>
<td align="left">aspartic_13C_15N</td>
<td align="left">138.048</td>
<td align="left">[M+H]+</td>
<td align="left">[M-H]-</td>
<td align="right">179</td>
<td align="left">2019_11_matrix_effect</td>
<td align="left">serum</td>
<td align="left">Mar Garcia-Aloy</td>
<td align="right">2</td>
<td align="left">1_good</td>
<td align="left">1_good</td>
<td align="left">139.055276</td>
<td align="left">139.050276</td>
<td align="left">139.060276</td>
<td align="right">169</td>
<td align="right">189</td>
<td align="left">2.983333333</td>
</tr>
</tbody>
</table>
<p>The target <code>data.frame</code> is created using
<code><a href="../reference/createTargetList.html">createTargetList()</a></code>. For more info on how to use the
function, check the help page: <code><a href="../reference/createTargetList.html">?createTargetList</a></code></p>
<p>Our biomarkers are defined as:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pablovgd.github.io/TARDIS/">TARDIS</a></span><span class="op">)</span></span>
<span><span class="va">targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createTargetList.html">createTargetList</a></span><span class="op">(</span><span class="st">"vignette_data/bio_targets.csv"</span>,</span>
<span>                            pos_pattern <span class="op">=</span> <span class="st">"+"</span>,</span>
<span>                            neg_pattern <span class="op">=</span> <span class="st">"-"</span>,</span>
<span>                            polarity <span class="op">=</span> <span class="st">"positive"</span>,</span>
<span>                            ion_column <span class="op">=</span> <span class="st">"POS"</span>,</span>
<span>                            columns_of_interest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"name"</span>, <span class="st">"mz"</span>, <span class="st">"rt"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">targets</span><span class="op">[</span><span class="fl">21</span><span class="op">:</span><span class="fl">26</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">ID</th>
<th align="left">NAME</th>
<th align="right">m/z</th>
<th align="right">tr</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">21</td>
<td align="left">21</td>
<td align="left">Unknown_1</td>
<td align="right">182.0749</td>
<td align="right">34.83789</td>
</tr>
<tr class="even">
<td align="left">22</td>
<td align="left">22</td>
<td align="left">Caffeine</td>
<td align="right">195.0877</td>
<td align="right">32.65668</td>
</tr>
<tr class="odd">
<td align="left">23</td>
<td align="left">23</td>
<td align="left">BENZYL METHYL SULFIDE</td>
<td align="right">161.0400</td>
<td align="right">162.13668</td>
</tr>
<tr class="even">
<td align="left">24</td>
<td align="left">24</td>
<td align="left">Anthranilic acid</td>
<td align="right">138.0547</td>
<td align="right">148.39599</td>
</tr>
<tr class="odd">
<td align="left">25</td>
<td align="left">25</td>
<td align="left">Isoproturon</td>
<td align="right">229.1299</td>
<td align="right">181.08828</td>
</tr>
<tr class="even">
<td align="left">26</td>
<td align="left">26</td>
<td align="left">Unknown_2</td>
<td align="right">560.3603</td>
<td align="right">33.54917</td>
</tr>
</tbody>
</table>
<p>Below we extract our dataset from the MetaboLigths database and load
it as an MsExperiment object. For more information on how to load your
data from the MetaboLights database, we refer to the <a href="https://rformassspectrometry.github.io/MsIO/articles/MsIO.html#loading-data-from-metabolights" class="external-link">MsIO
vignette</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsExperiment" class="external-link">MsExperiment</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsIO" class="external-link">MsIO</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsBackendMetaboLights" class="external-link">MsBackendMetaboLights</a></span><span class="op">)</span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MsIO/man/MetaboLightsParam.html" class="external-link">MetaboLightsParam</a></span><span class="op">(</span>mtblsId <span class="op">=</span> <span class="st">"MTBLS8735"</span>,</span>
<span>                           assayName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"a_MTBLS8735_LC-MS_positive_"</span>,</span>
<span>                                              <span class="st">"hilic_metabolite_profiling.txt"</span><span class="op">)</span>,</span>
<span>                           filePattern <span class="op">=</span> <span class="st">".mzML"</span><span class="op">)</span></span>
<span><span class="va">lcms1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MsIO/man/saveMsObject.html" class="external-link">readMsObject</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">MsExperiment</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      <span class="va">param</span>,</span>
<span>                      keepOntology <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      keepProtocol <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lcms1</span></span>
<span><span class="co">#&gt; Object of class MsExperiment </span></span>
<span><span class="co">#&gt;  Spectra: MS1 (17210) </span></span>
<span><span class="co">#&gt;  Experiment data: 10 sample(s)</span></span>
<span><span class="co">#&gt;  Sample data links:</span></span>
<span><span class="co">#&gt;   - spectra: 10 sample(s) to 17210 element(s).</span></span></code></pre></div>
<p>Simplifying the sampleData:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sample_name"</span>, <span class="st">"spectraOrigin"</span>,</span>
<span>                                <span class="st">"metabolite_asssignment_file"</span>,</span>
<span>                                <span class="st">"source_name"</span>,</span>
<span>                                <span class="st">"organism"</span>,</span>
<span>                                <span class="st">"blood_sample_type"</span>,</span>
<span>                                <span class="st">"type"</span>, <span class="st">"age"</span>, <span class="st">"unit"</span>, <span class="st">"phenotype"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add "QC" to the phenotype of the QC samples</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">$</span><span class="va">phenotype</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">==</span> <span class="st">"POOL"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"QC"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">$</span><span class="va">sample_name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">==</span> <span class="st">"POOL"</span> <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"POOL1"</span>, <span class="st">"POOL2"</span>, <span class="st">"POOL3"</span>, <span class="st">"POOL4"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">$</span><span class="va">type</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"pool"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"QC"</span></span>
<span></span>
<span><span class="co">#  Add injection index column</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">$</span><span class="va">injection_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spectraOrigin"</span>,</span>
<span>                     <span class="st">"phenotype"</span>, <span class="st">"sample_name"</span>, <span class="st">"type"</span>,</span>
<span>                     <span class="st">"injection_index"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">"pipe"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="32%">
<col width="11%">
<col width="13%">
<col width="23%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="left">spectraOrigin</th>
<th align="left">phenotype</th>
<th align="left">sample_name</th>
<th align="left">type</th>
<th align="right">injection_index</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">FILES/MS_QC_POOL_1_POS.mzML</td>
<td align="left">QC</td>
<td align="left">POOL1</td>
<td align="left">QC</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">FILES/MS_A_POS.mzML</td>
<td align="left">CVD</td>
<td align="left">A</td>
<td align="left">experimental sample</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">FILES/MS_B_POS.mzML</td>
<td align="left">CTR</td>
<td align="left">B</td>
<td align="left">experimental sample</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">FILES/MS_QC_POOL_2_POS.mzML</td>
<td align="left">QC</td>
<td align="left">POOL2</td>
<td align="left">QC</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">FILES/MS_C_POS.mzML</td>
<td align="left">CTR</td>
<td align="left">C</td>
<td align="left">experimental sample</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">FILES/MS_D_POS.mzML</td>
<td align="left">CVD</td>
<td align="left">D</td>
<td align="left">experimental sample</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">FILES/MS_QC_POOL_3_POS.mzML</td>
<td align="left">QC</td>
<td align="left">POOL3</td>
<td align="left">QC</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">FILES/MS_E_POS.mzML</td>
<td align="left">CTR</td>
<td align="left">E</td>
<td align="left">experimental sample</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">FILES/MS_F_POS.mzML</td>
<td align="left">CVD</td>
<td align="left">F</td>
<td align="left">experimental sample</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">FILES/MS_QC_POOL_4_POS.mzML</td>
<td align="left">QC</td>
<td align="left">POOL4</td>
<td align="left">QC</td>
<td align="right">10</td>
</tr>
</tbody>
</table>
<p><strong>IMPORTANT!</strong> The sample type column (indicating the
QCs) has to be named <code>type</code>. and the column indicating the
file has to be named <code>spectraOrigin</code>.</p>
</div>
<div class="section level2">
<h2 id="screening-mode">Screening mode<a class="anchor" aria-label="anchor" href="#screening-mode"></a>
</h2>
<p>First, we perform a screening step to check if our targets are
visible within our <em>m/z</em> and RT windows.</p>
<p>We can run screening mode using the argument
<code>screening_mode = TRUE</code> in the <code>tardisPeaks</code>
function.</p>
<p>For more details on the inputs of the function, please read the help
page <code><a href="../reference/tardisPeaks.html">?tardisPeaks</a></code></p>
<p>To limit the running time of this vignette, we limit the internal
standard targets to five, which should be enough for good RT alignment,
given their retention times span throughout most of the analysis. For
more info on how to choose the right “housekeeping compounds” for RT
alignment, we refer the reader to the <a href="https://sneumann.github.io/xcms/reference/adjustRtime.html" class="external-link">xcms
documentation</a>.</p>
<ul>
<li>L-Cystine (13C6, 99%; 15N2, 99%)</li>
<li>L-Methionine (13C5, 99%; 15N, 99%)</li>
<li>L-Glutamic acid (13C5, 99%; 15N, 99%)</li>
<li>L-Phenylalanine (13C9, 99%; 15N, 99%)</li>
<li>L-Serine (13C3, 99%; 15N, 99%)</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subset</span> <span class="op">&lt;-</span> <span class="va">targets</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>,<span class="fl">14</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">15</span>,<span class="fl">21</span><span class="op">:</span><span class="fl">26</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tardisPeaks.html">tardisPeaks</a></span><span class="op">(</span> lcmsData <span class="op">=</span> <span class="va">lcms1</span>, </span>
<span>                        dbData <span class="op">=</span> <span class="va">subset</span>,</span>
<span>                        mass_range <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                        polarity <span class="op">=</span> <span class="st">"positive"</span>,</span>
<span>                        output_directory <span class="op">=</span> <span class="st">"vignette_data/output/case/screening/"</span>,</span>
<span>                        batch_positions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        QC_pattern <span class="op">=</span> <span class="st">"QC"</span>,</span>
<span>                        int_std_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span>,</span>
<span>                        screening_mode <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Performing retention time correction using 5 peak groups.</span></span></code></pre></div>
<p>The resulting EICs are saved in the output folder and can be
inspected.</p>
<p><img src="vignette_data/output/case/screening/Diagnostic_QCs_Batch_1/Component_7.png" width="49%"><img src="vignette_data/output/case/screening/Diagnostic_QCs_Batch_1/Component_8.png" width="49%"><img src="vignette_data/output/case/screening/Diagnostic_QCs_Batch_1/Component_14.png" width="49%"><img src="vignette_data/output/case/screening/Diagnostic_QCs_Batch_1/Component_15.png" width="49%"><img src="vignette_data/output/case/screening/Diagnostic_QCs_Batch_1/Component_17.png" width="49%"><img src="vignette_data/output/case/screening/Diagnostic_QCs_Batch_1/Component_21.png" width="49%"><img src="vignette_data/output/case/screening/Diagnostic_QCs_Batch_1/Component_22.png" width="49%"><img src="vignette_data/output/case/screening/Diagnostic_QCs_Batch_1/Component_23.png" width="49%"><img src="vignette_data/output/case/screening/Diagnostic_QCs_Batch_1/Component_24.png" width="49%"><img src="vignette_data/output/case/screening/Diagnostic_QCs_Batch_1/Component_25.png" width="49%"><img src="vignette_data/output/case/screening/Diagnostic_QCs_Batch_1/Component_26.png" width="49%"></p>
<p>Based on the EICs we can see that detection, RT alignment and
integration of target peaks in QC runs were successful. However, the
signal of component 26, a non-annotated biomarker, is of remarkably
lower quality than the others. One pooled QC shows a high signal that is
absent in the other QC runs.</p>
</div>
<div class="section level2">
<h2 id="peak-detection">Peak detection<a class="anchor" aria-label="anchor" href="#peak-detection"></a>
</h2>
<p>Now we can perform peak detection in all our runs by setting
<code>screening_mode =  FALSE</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tardisPeaks.html">tardisPeaks</a></span><span class="op">(</span> lcmsData <span class="op">=</span> <span class="va">lcms1</span>, </span>
<span>                        dbData <span class="op">=</span> <span class="va">subset</span>,</span>
<span>                        mass_range <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                        polarity <span class="op">=</span> <span class="st">"positive"</span>,</span>
<span>                        output_directory <span class="op">=</span> <span class="st">"vignette_data/output/case/"</span>,</span>
<span>                        batch_positions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        QC_pattern <span class="op">=</span> <span class="st">"QC"</span>,</span>
<span>                        int_std_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span>,</span>
<span>                        screening_mode <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Performing retention time correction using 5 peak groups.</span></span>
<span><span class="co">#&gt; Aligning sample number 2 against subset ... OK</span></span>
<span><span class="co">#&gt; Aligning sample number 3 against subset ... OK</span></span>
<span><span class="co">#&gt; Aligning sample number 5 against subset ... OK</span></span>
<span><span class="co">#&gt; Aligning sample number 6 against subset ... OK</span></span>
<span><span class="co">#&gt; Aligning sample number 8 against subset ... OK</span></span>
<span><span class="co">#&gt; Aligning sample number 9 against subset ... OK</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>The <code>results</code> object is a <code>list</code> that contains
a <code>data.frame</code> with the AUC of each target in each run and a
<code>tibble</code> that contains a feature table with the average
metrics for each target in the QC runs.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AUC</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">AUC</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">Component</th>
<th align="right">MS_A_POS.mzML</th>
<th align="right">MS_B_POS.mzML</th>
<th align="right">MS_C_POS.mzML</th>
<th align="right">MS_D_POS.mzML</th>
<th align="right">MS_E_POS.mzML</th>
<th align="right">MS_F_POS.mzML</th>
<th align="right">MS_QC_POOL_1_POS.mzML</th>
<th align="right">MS_QC_POOL_2_POS.mzML</th>
<th align="right">MS_QC_POOL_3_POS.mzML</th>
<th align="right">MS_QC_POOL_4_POS.mzML</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">14</td>
<td align="right">16525.69812</td>
<td align="right">18002.5842</td>
<td align="right">16543.549</td>
<td align="right">17354.10495</td>
<td align="right">19069.943</td>
<td align="right">17914.6009</td>
<td align="right">19826.2410</td>
<td align="right">20773.350</td>
<td align="right">21403.3610</td>
<td align="right">20310.1275</td>
</tr>
<tr class="even">
<td align="left">15</td>
<td align="right">17633.56844</td>
<td align="right">18678.1921</td>
<td align="right">16358.943</td>
<td align="right">20086.53309</td>
<td align="right">19134.836</td>
<td align="right">11104.8497</td>
<td align="right">18041.7061</td>
<td align="right">17538.437</td>
<td align="right">19005.3145</td>
<td align="right">18484.4783</td>
</tr>
<tr class="odd">
<td align="left">17</td>
<td align="right">9696.06094</td>
<td align="right">10009.2589</td>
<td align="right">10862.924</td>
<td align="right">9731.80795</td>
<td align="right">10586.717</td>
<td align="right">11158.9709</td>
<td align="right">10348.6157</td>
<td align="right">10773.937</td>
<td align="right">10188.5909</td>
<td align="right">10082.6647</td>
</tr>
<tr class="even">
<td align="left">21</td>
<td align="right">NA</td>
<td align="right">3573.0464</td>
<td align="right">3157.537</td>
<td align="right">47.03151</td>
<td align="right">4260.996</td>
<td align="right">NA</td>
<td align="right">1498.4509</td>
<td align="right">2006.222</td>
<td align="right">1746.3844</td>
<td align="right">1378.9488</td>
</tr>
<tr class="odd">
<td align="left">22</td>
<td align="right">827.47100</td>
<td align="right">79504.3672</td>
<td align="right">116928.037</td>
<td align="right">2204.12719</td>
<td align="right">166453.150</td>
<td align="right">827.6966</td>
<td align="right">36758.7755</td>
<td align="right">40199.217</td>
<td align="right">39582.0053</td>
<td align="right">39544.2507</td>
</tr>
<tr class="even">
<td align="left">23</td>
<td align="right">28.60398</td>
<td align="right">384.4481</td>
<td align="right">632.872</td>
<td align="right">NA</td>
<td align="right">1976.859</td>
<td align="right">NA</td>
<td align="right">660.7771</td>
<td align="right">536.172</td>
<td align="right">715.3061</td>
<td align="right">672.9312</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feat_table</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">feat_table</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="6%">
<col width="7%">
<col width="7%">
<col width="5%">
<col width="6%">
<col width="6%">
<col width="3%">
<col width="1%">
<col width="24%">
<col width="5%">
<col width="6%">
<col width="6%">
<col width="3%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">Component</th>
<th align="right">AUC</th>
<th align="right">MaxInt</th>
<th align="right">SNR</th>
<th align="right">peak_cor</th>
<th align="right">foundRT</th>
<th align="right">pop</th>
<th align="left">ID</th>
<th align="left">NAME</th>
<th align="right">m.z</th>
<th align="right">tr</th>
<th align="right">mean</th>
<th align="left">na.rm</th>
<th align="right">trold</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">14</td>
<td align="right">20578.2698</td>
<td align="right">12635.3442</td>
<td align="right">16.64761</td>
<td align="right">0.9696404</td>
<td align="right">159.81106</td>
<td align="right">18.00</td>
<td align="left">14</td>
<td align="left">L-Methionine (13C5, 99%; 15N, 99%)</td>
<td align="right">156.0722</td>
<td align="right">159.81106</td>
<td align="right">159.81106</td>
<td align="left">TRUE</td>
<td align="right">161.00000</td>
</tr>
<tr class="even">
<td align="left">15</td>
<td align="right">18267.4839</td>
<td align="right">10256.7736</td>
<td align="right">12.89131</td>
<td align="right">0.9476993</td>
<td align="right">151.52398</td>
<td align="right">21.25</td>
<td align="left">15</td>
<td align="left">L-Phenylalanine (13C9, 99%; 15N, 99%)</td>
<td align="right">176.1135</td>
<td align="right">151.52398</td>
<td align="right">151.52398</td>
<td align="left">TRUE</td>
<td align="right">153.00000</td>
</tr>
<tr class="odd">
<td align="left">17</td>
<td align="right">10348.4520</td>
<td align="right">6464.6150</td>
<td align="right">19.84894</td>
<td align="right">0.9757596</td>
<td align="right">179.14857</td>
<td align="right">17.50</td>
<td align="left">17</td>
<td align="left">L-Serine (13C3, 99%; 15N, 99%)</td>
<td align="right">110.0570</td>
<td align="right">179.14857</td>
<td align="right">179.14857</td>
<td align="left">TRUE</td>
<td align="right">178.00000</td>
</tr>
<tr class="even">
<td align="left">21</td>
<td align="right">1657.5015</td>
<td align="right">918.1422</td>
<td align="right">12.93310</td>
<td align="right">0.9439880</td>
<td align="right">34.89898</td>
<td align="right">15.75</td>
<td align="left">21</td>
<td align="left">Unknown_1</td>
<td align="right">182.0749</td>
<td align="right">34.89898</td>
<td align="right">34.89898</td>
<td align="left">TRUE</td>
<td align="right">34.83789</td>
</tr>
<tr class="odd">
<td align="left">22</td>
<td align="right">39021.0621</td>
<td align="right">27834.8161</td>
<td align="right">30.26548</td>
<td align="right">0.9887586</td>
<td align="right">32.87623</td>
<td align="right">14.00</td>
<td align="left">22</td>
<td align="left">Caffeine</td>
<td align="right">195.0877</td>
<td align="right">32.87623</td>
<td align="right">32.87623</td>
<td align="left">TRUE</td>
<td align="right">32.65668</td>
</tr>
<tr class="even">
<td align="left">23</td>
<td align="right">646.2966</td>
<td align="right">392.2353</td>
<td align="right">17.00577</td>
<td align="right">0.9647597</td>
<td align="right">162.04193</td>
<td align="right">14.50</td>
<td align="left">23</td>
<td align="left">BENZYL METHYL SULFIDE</td>
<td align="right">161.0400</td>
<td align="right">162.04193</td>
<td align="right">162.04193</td>
<td align="left">TRUE</td>
<td align="right">162.13668</td>
</tr>
</tbody>
</table>
<p>Other results include tables with the other metrics (Max. Int., SNR,
peak_cor and points over the peak) and are saved into the output folder
in .csv format.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maxint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"vignette_data/output/case/int_table.csv"</span>,check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">SNR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"vignette_data/output/case/snr_table.csv"</span>,check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">peak_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"vignette_data/output/case/peakcor_table.csv"</span>,check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"vignette_data/output/case/pop_table.csv"</span>,check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="right">Component</th>
<th align="right">MS_A_POS.mzML</th>
<th align="right">MS_B_POS.mzML</th>
<th align="right">MS_C_POS.mzML</th>
<th align="right">MS_D_POS.mzML</th>
<th align="right">MS_E_POS.mzML</th>
<th align="right">MS_F_POS.mzML</th>
<th align="right">MS_QC_POOL_1_POS.mzML</th>
<th align="right">MS_QC_POOL_2_POS.mzML</th>
<th align="right">MS_QC_POOL_3_POS.mzML</th>
<th align="right">MS_QC_POOL_4_POS.mzML</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">14</td>
<td align="right">21</td>
<td align="right">22</td>
<td align="right">26</td>
<td align="right">25</td>
<td align="right">19</td>
<td align="right">20</td>
<td align="right">19</td>
<td align="right">18</td>
<td align="right">17</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="right">15</td>
<td align="right">23</td>
<td align="right">22</td>
<td align="right">25</td>
<td align="right">23</td>
<td align="right">24</td>
<td align="right">23</td>
<td align="right">21</td>
<td align="right">21</td>
<td align="right">22</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="right">17</td>
<td align="right">16</td>
<td align="right">20</td>
<td align="right">14</td>
<td align="right">15</td>
<td align="right">15</td>
<td align="right">14</td>
<td align="right">17</td>
<td align="right">18</td>
<td align="right">19</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="right">NA</td>
<td align="right">13</td>
<td align="right">20</td>
<td align="right">7</td>
<td align="right">13</td>
<td align="right">NA</td>
<td align="right">13</td>
<td align="right">21</td>
<td align="right">17</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="right">22</td>
<td align="right">10</td>
<td align="right">14</td>
<td align="right">13</td>
<td align="right">13</td>
<td align="right">14</td>
<td align="right">9</td>
<td align="right">15</td>
<td align="right">14</td>
<td align="right">14</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="right">23</td>
<td align="right">7</td>
<td align="right">12</td>
<td align="right">11</td>
<td align="right">NA</td>
<td align="right">23</td>
<td align="right">NA</td>
<td align="right">15</td>
<td align="right">12</td>
<td align="right">16</td>
<td align="right">15</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="exploratory-data-analysis">Exploratory data analysis<a class="anchor" aria-label="anchor" href="#exploratory-data-analysis"></a>
</h2>
<p>The next section of this vignette describes an example exploratory
data analysis using the results of TARDIS preprocessing.</p>
<div class="section level3">
<h3 id="pca">PCA<a class="anchor" aria-label="anchor" href="#pca"></a>
</h3>
<p>First, we use perform a principal component analysis (PCA) using the
AUC’s of our biomarkers:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># Limit input data to biomarkers and not ISTD targets</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">AUC</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">9</span>,<span class="op">]</span></span>
<span><span class="va">sampledata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Remove "FILES/" prefix</span></span>
<span><span class="va">sampledata</span><span class="op">$</span><span class="va">spectraOrigin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"FILES/"</span>, <span class="st">""</span>, <span class="va">sampledata</span><span class="op">$</span><span class="va">spectraOrigin</span><span class="op">)</span></span>
<span><span class="co"># Ensure row names correspond to Feature ID</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>  <span class="co"># Remove the feature ID column for PCA</span></span>
<span><span class="co"># Transpose the data so that samples are rows and features are columns</span></span>
<span><span class="va">data_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Impute NA values</span></span>
<span><span class="va">na_unidis</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">na</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">na</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">min</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">z</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="va">z</span><span class="op">[</span><span class="va">na</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">na</span><span class="op">)</span>, min <span class="op">=</span> <span class="va">min</span><span class="op">/</span><span class="fl">2</span>, max <span class="op">=</span> <span class="va">min</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">z</span></span>
<span><span class="op">}</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">data_t</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">na_unidis</span><span class="op">)</span></span>
<span><span class="va">data_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="co"># Perform PCA</span></span>
<span><span class="va">pca_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">data_t</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span>,center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Extract PCA scores</span></span>
<span><span class="va">pca_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">pca_df</span><span class="op">$</span><span class="va">Sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">pca_df</span><span class="op">)</span></span>
<span><span class="co"># Merge with sample metadata to get phenotype information</span></span>
<span><span class="va">pca_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">pca_df</span>, <span class="va">sampledata</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sample"</span> <span class="op">=</span> <span class="st">"spectraOrigin"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Plot PCA</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pca_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, color <span class="op">=</span> <span class="va">phenotype</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"PCA"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Principal Component 1"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Principal Component 2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Customize colors if needed</span></span></code></pre></div>
<p><img src="case_study_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>Results are as expected:</p>
<ul>
<li><p>QC samples cluster together, indicating little technical variance
in the analysis. However, one QC sample clearly differs from the others.
This is due to component 26, which, as shown earlier, showed a large
peak in one of the QC runs, but not in the others.</p></li>
<li><p>Samples with the CVD phenotype cluster together, more so than the
CTR samples indicating that the biomarkers vary less within in the CVD
phenotype as compared to the healthy controls.</p></li>
</ul>
<p>Disregarding component nr 26, the PCA looks like:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Limit input data to biomarkers and not ISTD targets</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">AUC</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">8</span>,<span class="op">]</span></span>
<span><span class="va">sampledata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Remove "FILES/" prefix</span></span>
<span><span class="va">sampledata</span><span class="op">$</span><span class="va">spectraOrigin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"FILES/"</span>, <span class="st">""</span>, <span class="va">sampledata</span><span class="op">$</span><span class="va">spectraOrigin</span><span class="op">)</span></span>
<span><span class="co"># Ensure row names correspond to Feature ID</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>  <span class="co"># Remove the feature ID column for PCA</span></span>
<span><span class="co"># Transpose the data so that samples are rows and features are columns</span></span>
<span><span class="va">data_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Impute NA values</span></span>
<span><span class="va">na_unidis</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">na</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">na</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">min</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">z</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="va">z</span><span class="op">[</span><span class="va">na</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">na</span><span class="op">)</span>, min <span class="op">=</span> <span class="va">min</span><span class="op">/</span><span class="fl">2</span>, max <span class="op">=</span> <span class="va">min</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">z</span></span>
<span><span class="op">}</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">data_t</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">na_unidis</span><span class="op">)</span></span>
<span><span class="va">data_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="co"># Perform PCA</span></span>
<span><span class="va">pca_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">data_t</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span>,center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Extract PCA scores</span></span>
<span><span class="va">pca_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">pca_df</span><span class="op">$</span><span class="va">Sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">pca_df</span><span class="op">)</span></span>
<span><span class="co"># Merge with sample metadata to get phenotype information</span></span>
<span><span class="va">pca_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">pca_df</span>, <span class="va">sampledata</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sample"</span> <span class="op">=</span> <span class="st">"spectraOrigin"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Plot PCA</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pca_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, color <span class="op">=</span> <span class="va">phenotype</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"PCA"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Principal Component 1"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Principal Component 2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Customize colors if needed</span></span></code></pre></div>
<p><img src="case_study_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="differential-abundance-analysis">Differential abundance analysis<a class="anchor" aria-label="anchor" href="#differential-abundance-analysis"></a>
</h3>
<p>In this section we perform differential abundance analysis to
investigate which differences in abudance of biomarkers we observe
between the two phenotype groups.</p>
<p>First we remove the ISTD targets from the data and impute missing
values.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Limit input data to biomarkers and not ISTD targets</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">AUC</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">8</span>,<span class="op">]</span></span>
<span><span class="va">sampledata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">lcms1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sampledata</span><span class="op">$</span><span class="va">spectraOrigin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"FILES/"</span>, <span class="st">""</span>, <span class="va">sampledata</span><span class="op">$</span><span class="va">spectraOrigin</span><span class="op">)</span></span>
<span><span class="co"># Ensure row names correspond to Feature ID</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>  <span class="co"># Remove the feature ID column for PCA</span></span>
<span><span class="va">data_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">na_unidis</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">na</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">na</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">min</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">z</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="va">z</span><span class="op">[</span><span class="va">na</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">na</span><span class="op">)</span>, min <span class="op">=</span> <span class="va">min</span><span class="op">/</span><span class="fl">2</span>, max <span class="op">=</span> <span class="va">min</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">z</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#' Row-wise impute missing values and add the data as a new assay</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">data_t</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">na_unidis</span><span class="op">)</span></span>
<span><span class="va">data_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Merge with sample metadata</span></span>
<span><span class="va">data_t</span><span class="op">$</span><span class="va">Sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">data_t</span><span class="op">)</span></span>
<span><span class="va">data_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">data_t</span>, <span class="va">sampledata</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sample"</span> <span class="op">=</span> <span class="st">"spectraOrigin"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_t</span> <span class="op">&lt;-</span> <span class="va">data_t</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">data_t</span><span class="op">$</span><span class="va">phenotype</span> <span class="op">==</span> <span class="st">"QC"</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<p>Next we visualize the log2 transformed abudances of each feature in
each group using boxplots.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boxdata</span> <span class="op">&lt;-</span> <span class="va">data_t</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">15</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">boxdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">boxdata</span>,cols <span class="op">=</span> <span class="op">!</span><span class="va">phenotype</span>,names_to <span class="op">=</span> <span class="st">"feature"</span>,values_to <span class="op">=</span> <span class="st">"abundance"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">boxdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">feature</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">)</span>, fill<span class="op">=</span><span class="va">phenotype</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>To test the differences for each biomarker, we use to
<code>wilcox.test</code> function. From the boxplots above, we known
that the biomarkers are underrepresented in the CVD phenotype, hence, we
use the <code>alternative = "less"</code> option in the
<code>wilcox.test</code> function. Data is log2 transformed.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data_t</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, p_value <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">feature_values</span> <span class="op">&lt;-</span> <span class="va">data_t</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">group1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">feature_values</span><span class="op">[</span><span class="va">data_t</span><span class="op">$</span><span class="va">phenotype</span> <span class="op">==</span> <span class="st">"CVD"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">group2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">feature_values</span><span class="op">[</span><span class="va">data_t</span><span class="op">$</span><span class="va">phenotype</span> <span class="op">==</span> <span class="st">"CTR"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">pres</span><span class="op">$</span><span class="va">p_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="va">group1</span>, <span class="va">group2</span>,alternative <span class="op">=</span> <span class="st">"less"</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span>  <span class="op">}</span></span>
<span><span class="va">pres</span><span class="op">$</span><span class="va">adj_p_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">pres</span><span class="op">$</span><span class="va">p_value</span>, method <span class="op">=</span> <span class="st">"fdr"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">pres</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Feature</th>
<th align="right">p_value</th>
<th align="right">adj_p_value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">21</td>
<td align="right">0.05</td>
<td align="right">0.05</td>
</tr>
<tr class="even">
<td align="left">22</td>
<td align="right">0.05</td>
<td align="right">0.05</td>
</tr>
<tr class="odd">
<td align="left">23</td>
<td align="right">0.05</td>
<td align="right">0.05</td>
</tr>
<tr class="even">
<td align="left">24</td>
<td align="right">0.05</td>
<td align="right">0.05</td>
</tr>
<tr class="odd">
<td align="left">25</td>
<td align="right">0.05</td>
<td align="right">0.05</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Based on the results preprocessed using <code>TARDIS</code>, we can
conclude that the earlier discovered metabolites are indeed valid
biomarkers for the CVD phenotype and are significantly underrepresented
in the CVD samples.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pablo Vangeenderhuysen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
